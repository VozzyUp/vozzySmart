{
  "evidence_id": "RLS-001",
  "timestamp": "2026-02-02T00:05:00Z",
  "category": "api-audit",
  "type": "rls_audit",
  "project_id": "qqhtcsbwjwoendqnwkld",

  "total_tables": 38,
  "rls_enabled_count": 38,
  "rls_disabled_count": 0,

  "tables_with_anon_select_policy": {
    "count": 7,
    "policy_type": "PERMISSIVE SELECT USING(true)",
    "tables": [
      {
        "table": "contacts",
        "severity": "P1-HIGH",
        "anon_grants": ["SELECT"],
        "policy": "anon_select_contacts → USING(true)",
        "data_accessible": "0 rows currently (empty), but ALL contacts with PII (name, phone, email) would be exposed",
        "write_blocked": true,
        "issue": "Contains PII (phone numbers, emails, names). Any data added will be publicly readable via anon key."
      },
      {
        "table": "inbox_conversations",
        "severity": "P1-HIGH",
        "anon_grants": ["SELECT"],
        "policy": "anon_select_inbox_conversations → USING(true)",
        "data_accessible": "0 rows currently (empty)",
        "write_blocked": true,
        "issue": "Contains phone numbers, message previews, conversation status. Private communication metadata exposed."
      },
      {
        "table": "inbox_messages",
        "severity": "P1-HIGH",
        "anon_grants": ["SELECT"],
        "policy": "anon_select_inbox_messages → USING(true)",
        "data_accessible": "0 rows currently (empty)",
        "write_blocked": true,
        "issue": "Contains actual message content, media URLs. Private communication content exposed."
      },
      {
        "table": "campaigns",
        "severity": "P2-MEDIUM",
        "anon_grants": ["SELECT"],
        "policy": "anon_select_campaigns → USING(true)",
        "data_accessible": "0 rows currently (empty)",
        "write_blocked": true,
        "issue": "Campaign names, template configs, scheduling info exposed. Business intelligence leakage."
      },
      {
        "table": "templates",
        "severity": "P2-MEDIUM",
        "anon_grants": ["SELECT"],
        "policy": "anon_select_templates → USING(true)",
        "data_accessible": "74 rows with full template data (name, components, spec_hash)",
        "write_blocked": true,
        "issue": "Template names and body content readable. Low sensitivity but exposes business communication patterns."
      },
      {
        "table": "flows",
        "severity": "P2-MEDIUM",
        "anon_grants": ["SELECT"],
        "policy": "anon_select_flows → USING(true)",
        "data_accessible": "0 rows currently (empty)",
        "write_blocked": true,
        "issue": "Flow definitions and specs readable. Exposes automation logic."
      },
      {
        "table": "account_alerts",
        "severity": "P3-LOW",
        "anon_grants": ["SELECT"],
        "policy": "anon_select_account_alerts → USING(true)",
        "data_accessible": "0 rows currently (empty)",
        "write_blocked": true,
        "issue": "Account health alerts. Low sensitivity but could reveal system issues to attackers."
      }
    ]
  },

  "tables_without_policies": {
    "count": 31,
    "status": "FULLY BLOCKED (RLS on + no policies = deny all)",
    "tables": [
      "ai_agent_logs", "ai_agents", "ai_embeddings", "ai_knowledge_files",
      "attendant_tokens", "campaign_batch_metrics", "campaign_contacts",
      "campaign_folders", "campaign_run_metrics", "campaign_tag_assignments",
      "campaign_tags", "campaign_trace_events", "custom_field_definitions",
      "flow_submissions", "inbox_conversation_labels", "inbox_labels",
      "inbox_quick_replies", "lead_forms", "phone_suppressions",
      "push_subscriptions", "settings", "template_project_items",
      "template_projects", "whatsapp_status_events",
      "workflow_builder_executions", "workflow_builder_logs",
      "workflow_conversations", "workflow_run_logs", "workflow_runs",
      "workflow_versions", "workflows"
    ]
  },

  "write_operations": {
    "anon_insert": "BLOCKED on all 38 tables",
    "anon_update": "BLOCKED on all 38 tables",
    "anon_delete": "BLOCKED on all 38 tables"
  }
}
